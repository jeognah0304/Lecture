

# x,y 변수설명

x는 입력변수, y는 출력변수로 설정하였다.
단순회귀분석에 관한 함수를 만들 생각이므로, x는 독립변수 y는 종속변수로 보겠다.

일단, 데이터가 없어서, 저는 임의로 만들고 싶으므로
x는 표준정규분포에서 샘플사이즈 N의 크기만큼 뽑고,
y도 똑같이 표준정규분포에서 샘플사이즈 N의 크기만큼 뽑는데, x 뽑은값을 그냥 더해보았다
(이유는 없다. 그냥)

그래서 x와 y를 plot해보니, 
난수생성이므로 뽑을때마다 다르지만, 제가 실행했을 당시엔 얼추 선형성이 있어 보였다.
산점도plot(x,y)와 상관계수 코드 cor(x,y)를 실행해보았을 때 회귀분석을 할 만한 가치가 있어 보였다.


# 함수 설명

함수안에 7가지 output이 나오도록 벡터형식으로 짜 보았다.
그리고 마지막의 그 7가지는 list형식으로 나오게 마무리하였다.
plot=T 여부에 따라 plots 탭에 새롭게 산점도와 최소제곱법으로 구한 회귀식을 표시하고
R-squared값을 나타내게끔 코드를 짜 보았다.
기존에 x,y 말고 새로운 x를 내가 넣었을 때 어떤 y가 기대되는지 궁금하니
newx=데이터값 넣으면 어떤 y가 나올지도 코드를 짜 보았다.


1st output
단순선형회귀 계수를 벡터형식으로 출력하였다.
식은 최소제곱법에 의해 공식을 도출할 수 있다.

2nd output 
R^2 값을 R_squared 라는 내가 만들고싶은 새로운 객체에 집어넣었다.

3rd output
일단, 아노바 테이블 만들려면 테이블 안에 내용이 될 객체들이 필요하다고 생각했다.
그래서 각 sum of square 값을 객체로 만들어보았다(MSR, MSE, SST, SSR, SSE )...
그리고 아노바테이블의 각 행 부분을 크기3인 벡터로 만들었고, cbind를 통해 
매트릭스형식? 으로 데이터로 합쳤다. 근데 코드를 실행시킬때 왜 그런건진 모르겠지만
테이블에 이름 넣을때 에러가 나서 cbind로 각 벡터를 합친 뒤 data.frame형식으로 바꾼 다음에
names라는 함수를 이용해서 이름을 부여하였다

4th output
산점도를 내가 plot==T라는 옵션을 넣었을때 그리도록 if문을 사용하여서 나타내었다.
그냥 산점도 그리면 심심하니까 x축과 y축에 각각 dependent variable , independent variable이라고 이름을 넣었다.
(각각 xlab=, ylab=이라는 것을 이용해서 넣었다.)
그리고 그것만 넣으면 섭하니까 "Scatter plot"이라는 이름을 title함수를 써서 맨 위 중앙에 집어 넣었다.
회귀식도 표현하면 회귀식과 실제 데이터가 얼마나 잘 맞는지 시각적으로 알 수 있으니까
abline함수를 이용해서 회귀식도 추가로 빨간색으로 넣었다.
설명력도 심심하니 오른쪽 아래에 넣었다. 그냥 R2를 넣으면 헷깔릴 수 있으니까 빨간색 회귀직선에 맞게
저 회귀식이 설명력이 이정도다 라는걸 표현하기 위해 다이아몬드(pch=18) 범례???를 legend함수를 통해 넣어보았다
빨간색으로 최소제곱법으로 추정된 회귀식도 위에 추가하였다.
추가방법은 func이라는 객체에 paste를 이용해서 캐릭터벡터는 따옴표로, 숫자는 round써서 5번째자리까지 표시하게끔 해서
다닥다닥 붙인 paste함수를 구현하고, 그걸 func라는 빈 객체에 저장하였다.
그래서 그 객체를 text함수를 이용해서 그려보았다. 위치 잡는게 좀 어려웠는데
median과 max함수, 그리고 숫자를 곱해서 어떻게든 오른쪽 중앙에 위치하게끔 해보았다.


5th output
회귀계수를 anova테이블로 직접..구현하는거였는데
이게 공식이, b1, b0를 최소제곱추정법으로 구할 수가 있는데
이 구한 값들은 yi에 관한 선형결합으로 나타낼 수 있었다.
그래서 뭐 예를들면 var(b1) = var(summation C(i)y(i) ) 식으로해서
var(yi)가 시그마제곱인데, 앞에 c(i) 파트는 x라는 데이터, 그니까 음... random variable파트가 아니니까
상수처럼 나올수있어서 여하튼 수식들을 글로 쓰려니 힘든데, 계산해보면

var(b1) = sqrt (시그마^2 / Sxx )
var(b0) = sqrt {시그마^2*(1/n +x.bar^2/Sxx )}
뭐 이런 꼴이 나온다. 근데 시그마는 모수라서 우리가 알 수가 없는거고 그러면 추정한 분산을 넣으면되는데
여기 회귀분석에서 시그마의 불편추정량이 MSE라서 시그마 제곱에 MSE를 갈아끼운 다음에 계산하면 된다

그래서 그 계산법을 se 벡터로 구현한거고


그 담에, T 통계량은 추정한 estimate 에 그 추정한 값의 standard error로 나누면 된다.
그래서 t라는 크기 2인 벡터를 만들었다 

그다음에 p-value구하는거....
 H0 : b1 = 0,
 H0 : b0 = 0인 귀무가설이고, 대립가설은 각각 0이 아니다인 두개의 가설이 나오는데
이 말이 그 , p-value구할때 양측검정이란 얘기라서 pt() 함수 안에 두배를 곱해야 p-value가 나온다
그래서 pt함수를 써서 구현을 해 보았고
자유도를 조심해야하는데, 원래 그냥 회귀분석 모델에 관한 anova는 자유도가 SSR은 단순회귀에선 1
SSE 는 모델하나 추정하면서 자유도 1이 모델로 빠져나가버려가지고
N-2로 줄어든다. 그리고 SST 는 평균을 여하튼 추정한거니 그만큼 정보손실?????? 같은게 일어나서
N-1인 자유도인데

여기 회귀계수 추정할때는 N-추정된 모수의 개수 이다.그래서 N-2로 했다.
왜 그랬는지는 이석훈교수님께 배웠었던거 같은데 안타깝게도 지금 기억에 없다..

여튼, p.value에 관한 각 개체를 b0에 관한 p-value를 p.b0
추정한 b1에 관한 p-value를 p.b1으로 객체에 저장하고
p라는 벡터를 만들어서 위에 저장한 두 객체를 가지고 크기가 2인 벡터를 만들었다.


그래서 위에 coef(회귀계수를 저장한 벡터), se(회귀계수의 standard error를 저장한 벡터),
 t (T검정통계량을 저장한 벡터), p(p-value를 저장한 벡터)를 cbind를 통해서 매트릭스로 만들었다.
그 매트릭스는 coeftab이라는 객체에 저장하였다.

음, 근데 실행해보니 이게 소수점 숫자가 너무 길어서 당황스러워가지고
round함수를 통해 소수점 6째자리까지 표시하도록 하였다. 그걸 coeftab에 다시 씌워서 결과가 나오게끔 구현했다.

coefficient값이 헷깔릴까봐 rownames()함수를 써서, b0인지 b1인지 구분하기 위해
intercept, x라는 각각 이름을 부여하였다.

6th Output

 summary(g0)를 교수님께서 구현하라고 하셨는데 거기에 보니 잔차에 대한 다섯수치요약이 있었다.
그래서 res라는 새로운 객체에 y - 추정된 회귀식에 x를 대입한 값을 저장하였다.
그리고 그 값의 fivenum이란 함수를 써서 다섯수치요약을 써보았다

이름은 Min, lower-hinge, median, upper-hinge, Max로 names를 써서 만들었는데
그게 이 함수에서 써져있는대로 한거고, 아마 이게 lower-hinge가 1st quatile인가 그렇고
upper-hinge가 3rd quatile인가 그럴건데, 혹시나해서 ?fivenum설명대로 그냥 요렇게 표현했습니다.


7th output
그, 원래 가진 데이터 말고 새롭게 내가 x를 넣었을때 회귀식에 따르면 y가 얼마의 값으로 나올지
우리가 궁금해서 추정해볼 수 있을것이다.

기존에 가지지 않은 새로운 x데이터를 넣을지 말지는 코드 쓰는 사람 마음이니까
그 사람을 배려해서 if{} else{}문을 사용해보았다.

if문으로, 새로운 x데이터를 넣지 않았다면 결과값이 나오지 않게, 새로운 x 데이터를 넣었다면
추가로 y값이 얼마가 나올지 덧붙이는 형태의 결과가 나오도록 구현했다.


if(새로운x데이터가 있다면) {예측값구해주고, 결과물을 out이라는 리스트형식에 넣어주고} 
else{만약 새로운x 데이터가 없다면, 앞에 output6까지 내가 짰던 것들을 list형식으로 보여달라}
라는 명령문으로 만들어 보았다. 


예측값에 대한 것은 new.pred 라는 객체에 추정한 b0,b1 이용해서 객체에 저장했고..
out이라는 리스트에 앞의 결과물을쭉 넣었다. 근데 리스트 그냥 실행하니까 좀 안이쁜거같아서
보는 사람이 편하게끔 names 함수 써서 알아보기 쉽게 이쁘게 표현하려고 노력했다.










함수 전체 실행해보고, 확인을 해 보았으며
다른 데이터도 써 봤는데 구현이 잘 되어서 저의 지식범위 하에선 코드에 이상이 없어보였다.


여튼, 설명쓰느라 너무 힘들었는데. 읽는분도 힘들었을거라 생각합니다
여튼 읽어주셔서 감사합니다^_^